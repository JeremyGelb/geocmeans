<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Fuzzy CMean with R • geocmeans</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Fuzzy CMean with R">
<meta property="og:description" content="geocmeans">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocmeans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adjustinconsistency.html">An adjusted spatial inconsistency index</a>
    </li>
    <li>
      <a href="../articles/FCMres.html">Creating a FCMres object</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Spatial Fuzzy CMean with R</a>
    </li>
    <li>
      <a href="../articles/rasters.html">Fuzzy clustering with rasters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/geocmeans/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="introduction_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Spatial Fuzzy CMean with R</h1>
                        <h4 class="author">Jeremy Gelb</h4>
            
            <h4 class="date">02/04/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/geocmeans/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This document is a short introduction to the package <strong>geocmeans</strong>. It implements fuzzy classification methods bringing spatial information and neighbouring in its calculation</p>
<p>In their article, <span class="citation"><a href="#ref-cai2007fast" role="doc-biblioref">Cai, Chen, and Zhang</a> (<a href="#ref-cai2007fast" role="doc-biblioref">2007</a>)</span> described the method, originally applied in the analysis of brain imagery. The generalized version of the spatial fuzzy c-means is presented by <span class="citation"><a href="#ref-zhao2013kernel" role="doc-biblioref">Zhao, Jiao, and Liu</a> (<a href="#ref-zhao2013kernel" role="doc-biblioref">2013</a>)</span>.</p>
<p><span class="citation"><a href="#ref-gelb2021apport" role="doc-biblioref">Gelb and Apparicio</a> (<a href="#ref-gelb2021apport" role="doc-biblioref">2021</a>)</span> applied the method to socio-residential and environmental data comparing the results with other unsupervised classification algorithms (in French).</p>
<p>There are actually numerous packages and functions to perform unsupervised classification in R (<em>hclust</em>, <em>kmeans</em>, <em>cmeans</em>, <em>factoextra</em>, etc.). However, these methods are not always well-suited to analyze spatial data. Indeed, they do not account for spatial information such as proximity or contiguity between observations. This may lead to solutions for which close observations end up in different groups event though they are very similar.</p>
<p>To our knowledge, the package <strong>ClustGeo</strong> is the only package proposing an unsupervised classification method which directly consider spatial proximity between observations. The proposed approach is appealing because the user can select a parameter (<em>alpha</em>) that controls the weight of the spatial distance matrix (calculated between observations with their locations) versus the semantic distance matrix (calculated between observations with their variables).</p>
<p>However, this method belongs to the category of “hard-clustering” algorithms. Each observation ends up in one cluster/group. The main draw-back here is the difficulty to identify observations that are undecided, at the frontier of two clusters/groups. The soft or fuzzy clustering algorithms provide more information because they calculate the “probability” of each observation to belong to each group.</p>
<p>The algorithms SFCM (spatial fuzzy c-means) and SGFCM (spatial generalized fuzzy c-means) propose to combine the best of both worlds.</p>
<p>The package <strong>geocmeans</strong> is an implementation in R of these methods. It comes with a set of functions to facilitate the analysis of the final membership matrices:</p>
<ul>
<li>calculating many quality indices (coming mainly from the package <em>fclust</em>)</li>
<li>mapping the results</li>
<li>giving summary statistics for each cluster/group</li>
<li>a shiny app to investigate dynamically the results.</li>
</ul>
<p>The general workflow for applying a spatial fuzzy clustering algorithm with <strong>geocmeans</strong> is described with the following figure.</p>
<center>
<img src="images/workflow.png" title="fig:" height="800" alt="Image Title">
</center>
</div>
<div id="loading-the-packages-and-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-packages-and-the-data" class="anchor"></a>Loading the packages and the data</h2>
<p><strong>geocmeans</strong> comes with a toy dataset <em>LyonIris</em>, combining many demographic and environmental variables aggregated at the scale of the Iris (aggregated units for statistical information) in Lyon (France).</p>
<p>Note that the dataset used for a fuzzy classification can only contain continuous variables. For dataset with categorical variables, one could start with a PCA (Principal Component Analysis), MCA (multiple Correspondence Analysis) or a MDFA (Mixed Data Factor Analysis) and uses the obtained factors as inputs for the clustering.</p>
<p>Before starting the analysis, the data must be standardized because most of the calculus is based on Euclidean distance (we plan to also include Manhattan distance in a future release).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#charging packages and data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans">geocmeans</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/">viridis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span>

<span class="co"># selecting the columns for the analysis</span>
<span class="va">AnalysisFields</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Lden"</span>,<span class="st">"NO2"</span>,<span class="st">"PM25"</span>,<span class="st">"VegHautPrt"</span>,<span class="st">"Pct0_14"</span>,
                   <span class="st">"Pct_65"</span>,<span class="st">"Pct_Img"</span>,<span class="st">"TxChom1564"</span>,<span class="st">"Pct_brevet"</span>,<span class="st">"NivVieMed"</span><span class="op">)</span>

<span class="co"># rescaling the columns</span>
<span class="va">Data</span> <span class="op">&lt;-</span> <span class="va">LyonIris</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">AnalysisFields</span><span class="op">]</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">Col</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Data</span><span class="op">[[</span><span class="va">Col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/scale.html">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[[</span><span class="va">Col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># preparing some elements for further mapping</span>
<span class="va">LyonIris</span><span class="op">$</span><span class="va">OID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.character.html">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">)</span><span class="op">)</span>
<span class="va">FortiData</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/fortify.html">fortify</a></span><span class="op">(</span><span class="va">LyonIris</span>,region<span class="op">=</span><span class="st">"OID"</span><span class="op">)</span></code></pre></div>
</div>
<div id="classical-kmeans" class="section level2">
<h2 class="hasAnchor">
<a href="#classical-kmeans" class="anchor"></a>Classical Kmeans</h2>
<p>To explore the dataset and choose the right number of cluster/groups (k) we propose to start with a classical kmeans.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># finding the best k by using the r2 of the classification</span>
<span class="co"># trying for k from 2 to 10</span>
<span class="va">R2s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>,<span class="kw">function</span><span class="op">(</span><span class="va">k</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">Data</span>,centers<span class="op">=</span><span class="va">k</span>,iter.max <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>
  <span class="va">R2</span> <span class="op">&lt;-</span> <span class="va">Clust</span><span class="op">$</span><span class="va">betweenss</span> <span class="op">/</span> <span class="va">Clust</span><span class="op">$</span><span class="va">totss</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">R2</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">Df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>K<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">10</span>,
                 R2 <span class="op">=</span> <span class="va">R2s</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Df</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">K</span>,y<span class="op">=</span><span class="va">R2s</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">K</span>,y<span class="op">=</span><span class="va">R2s</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Number of groups"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"R2 of classification"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-3-1.png" alt="Impact of the number of groups on the explained variance" width="50%"><p class="caption">
Impact of the number of groups on the explained variance
</p>
</div>
<p>By plotting the R-squared of the kmeans classification for each k between 2 and 10, we can see a first elbow at k=3. But this small number of groups leads to a classification explaining only 43% of the original data variance. We decide to keep k=4 to have one more group in the analysis.</p>
<p>Let us map the obtained groups.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">KMeanClust</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">Data</span>,centers<span class="op">=</span><span class="fl">4</span>,iter.max <span class="op">=</span> <span class="fl">150</span><span class="op">)</span>
<span class="va">LyonIris</span><span class="op">$</span><span class="va">Cluster</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"cluster"</span>,<span class="va">KMeanClust</span><span class="op">$</span><span class="va">cluster</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>

<span class="co"># mapping the groups</span>
<span class="va">DFmapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/merge.html">merge</a></span><span class="op">(</span><span class="va">FortiData</span>,<span class="va">LyonIris</span>,by.x<span class="op">=</span><span class="st">"id"</span>,by.y<span class="op">=</span><span class="st">"OID"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">DFmapping</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span>,fill<span class="op">=</span><span class="va">Cluster</span><span class="op">)</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Cluster"</span>,values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cluster_1"</span><span class="op">=</span><span class="st">"palegreen3"</span>,
                                 <span class="st">"cluster_2"</span><span class="op">=</span><span class="st">"firebrick"</span>,
                                 <span class="st">"cluster_3"</span><span class="op">=</span><span class="st">"lightyellow2"</span>,
                                 <span class="st">"cluster_4"</span><span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span> axis.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-4-1.png" alt="Clusters identified by classical k-means" width="700"><p class="caption">
Clusters identified by classical k-means
</p>
</div>
<p>We can clearly distinguish 4 strong spatial structures, but with some mixing between the clusters.</p>
<p>We could now compare this solution with a classical c-means algorithm.</p>
</div>
<div id="classical-c-means-and-generalized-c-means" class="section level2">
<h2 class="hasAnchor">
<a href="#classical-c-means-and-generalized-c-means" class="anchor"></a>Classical c-means and generalized c-means</h2>
<p>The classical c-means is a simple method to perform fuzzy unsupervised classification. The package <strong>geocmeans</strong> proposes the function <em>CMeans</em>. We set the fuzziness degree (m) to 1.5.</p>
<p>We do not present the algorithm here, but only the two main formulas.</p>
<p>The first one is used to update the values of the membership matrix at each iteration <span class="math inline">\(u_ik\)</span></p>
<p><span class="math display">\[u_{ik} = \frac{(||x_{k} - v{_i}||^{2}) ^{(-1/(m-1))}}{\sum_{j=1}^c(||x_{k} - v{_j}||^2 )^{(-1/(m-1))}}\]</span> And the second one to update the centers of the clusters</p>
<p><span class="math display">\[v_{i} = \frac{\sum_{k=1}^N u_{ik}^m(x_{k})}{\sum_{k=1}^N u_{ik}^m}\]</span></p>
<p>With :</p>
<ul>
<li>
<span class="math inline">\(x_k\)</span> the values of the observation <span class="math inline">\(k\)</span>
</li>
<li>
<span class="math inline">\(v_i\)</span> the values of the center of the cluster <span class="math inline">\(i\)</span>
</li>
<li>
<span class="math inline">\(c\)</span> the number of clusters</li>
<li>
<span class="math inline">\(m\)</span> the fuzziness index</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cmean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CMeans.html">CMeans</a></span><span class="op">(</span><span class="va">Data</span>,<span class="fl">4</span>,<span class="fl">1.5</span>,<span class="fl">500</span>,standardize <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span>, tol <span class="op">=</span> <span class="fl">0.00001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We can now use the function <em>calcqualityIndexes</em> which combines many indices from the package <strong>fclust</strong> to analyze the quality of the classification. We will use these values later for the purpose of comparisons among the different algorithms.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">Cmean</span><span class="op">$</span><span class="va">Belongings</span>, m <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<pre><code>## $Silhouette.index
## [1] 0.362851
## 
## $Partition.entropy
## [1] 0.7320161
## 
## $Partition.coeff
## [1] 0.6070524
## 
## $XieBeni.index
## [1] 1.352347
## 
## $FukuyamaSugeno.index
## [1] 1860.772
## 
## $Explained.inertia
## [1] 0.3018179</code></pre>
<p>Note, <strong>geocmeans</strong> also proposes a so-called generalized version of the c-means algorithm. It is known to accelerate convergence and yield less fuzzy results by adjusting the membership matrix at each iteration. It requires an extra <em>beta</em> parameter controlling the strength of the modification. The modification only affects the formula updating the membership matrix.</p>
<p><span class="math display">\[u_{ik} = \frac{(||x_{k} - v{_i}||^{2} - \beta_k) ^{(-1/(m-1))}}{\sum_{j=1}^c(||x_{k} - v{_j}||^2 - \beta_k)^{(-1/(m-1))}}\]</span></p>
<p>with <span class="math inline">\(\beta_k = min(||x_{k} - v||^2)\)</span> and <span class="math inline">\(0 \leq \beta \leq 1\)</span>.</p>
<p>To select an appropriate value for this parameter, we will try all the possible values between 0 and 1 with a step of 0.05.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">beta_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_parameters.html">selectParameters</a></span><span class="op">(</span><span class="st">"GFCM"</span>,data <span class="op">=</span> <span class="va">Data</span>, k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>,
                                 beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.05</span><span class="op">)</span>, spconsist <span class="op">=</span> <span class="cn">FALSE</span>,
                                 tol <span class="op">=</span> <span class="fl">0.00001</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">beta_values</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta"</span>,<span class="st">"Silhouette.index"</span>,<span class="st">"XieBeni.index"</span>,<span class="st">"Explained.inertia"</span><span class="op">)</span><span class="op">]</span>,
             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"beta"</span>, <span class="st">"silhouette index"</span>,
                           <span class="st">"Xie and Beni index"</span>, <span class="st">"explained inertia"</span><span class="op">)</span>,digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">beta</th>
<th align="right">silhouette index</th>
<th align="right">Xie and Beni index</th>
<th align="right">explained inertia</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.00</td>
<td align="right">0.363</td>
<td align="right">1.352</td>
<td align="right">0.302</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.365</td>
<td align="right">1.268</td>
<td align="right">0.310</td>
</tr>
<tr class="odd">
<td align="right">0.10</td>
<td align="right">0.366</td>
<td align="right">1.193</td>
<td align="right">0.319</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.365</td>
<td align="right">1.128</td>
<td align="right">0.327</td>
</tr>
<tr class="odd">
<td align="right">0.20</td>
<td align="right">0.361</td>
<td align="right">1.071</td>
<td align="right">0.336</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.360</td>
<td align="right">1.020</td>
<td align="right">0.345</td>
</tr>
<tr class="odd">
<td align="right">0.30</td>
<td align="right">0.363</td>
<td align="right">0.984</td>
<td align="right">0.354</td>
</tr>
<tr class="even">
<td align="right">0.35</td>
<td align="right">0.361</td>
<td align="right">0.963</td>
<td align="right">0.363</td>
</tr>
<tr class="odd">
<td align="right">0.40</td>
<td align="right">0.370</td>
<td align="right">0.943</td>
<td align="right">0.372</td>
</tr>
<tr class="even">
<td align="right">0.45</td>
<td align="right">0.369</td>
<td align="right">0.924</td>
<td align="right">0.381</td>
</tr>
<tr class="odd">
<td align="right">0.50</td>
<td align="right">0.366</td>
<td align="right">0.907</td>
<td align="right">0.390</td>
</tr>
<tr class="even">
<td align="right">0.55</td>
<td align="right">0.365</td>
<td align="right">0.891</td>
<td align="right">0.399</td>
</tr>
<tr class="odd">
<td align="right">0.60</td>
<td align="right">0.360</td>
<td align="right">0.876</td>
<td align="right">0.409</td>
</tr>
<tr class="even">
<td align="right">0.65</td>
<td align="right">0.358</td>
<td align="right">0.863</td>
<td align="right">0.418</td>
</tr>
<tr class="odd">
<td align="right">0.70</td>
<td align="right">0.358</td>
<td align="right">0.852</td>
<td align="right">0.428</td>
</tr>
<tr class="even">
<td align="right">0.75</td>
<td align="right">0.353</td>
<td align="right">0.843</td>
<td align="right">0.437</td>
</tr>
<tr class="odd">
<td align="right">0.80</td>
<td align="right">0.347</td>
<td align="right">0.838</td>
<td align="right">0.447</td>
</tr>
<tr class="even">
<td align="right">0.85</td>
<td align="right">0.340</td>
<td align="right">0.837</td>
<td align="right">0.456</td>
</tr>
<tr class="odd">
<td align="right">0.90</td>
<td align="right">0.332</td>
<td align="right">0.844</td>
<td align="right">0.464</td>
</tr>
<tr class="even">
<td align="right">0.95</td>
<td align="right">0.323</td>
<td align="right">0.861</td>
<td align="right">0.471</td>
</tr>
<tr class="odd">
<td align="right">1.00</td>
<td align="right">0.317</td>
<td align="right">0.919</td>
<td align="right">0.475</td>
</tr>
</tbody>
</table>
<p>Considering the table above, we select <em>beta</em> = 0.7, it maintains a good silhouette index, and increases Xie and Beni index and explained inertia. Let us compare the results of GFCM and FCM.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GCmean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GCMeans.html">GCMeans</a></span><span class="op">(</span><span class="va">Data</span>,k <span class="op">=</span> <span class="fl">4</span>,m <span class="op">=</span> <span class="fl">1.5</span>, beta <span class="op">=</span> <span class="fl">0.7</span>,<span class="fl">500</span>,standardize <span class="op">=</span> <span class="cn">FALSE</span>, seed<span class="op">=</span><span class="fl">456</span>,
                  tol <span class="op">=</span> <span class="fl">0.00001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">Data</span>,<span class="va">GCmean</span><span class="op">$</span><span class="va">Belongings</span>,m<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">Data</span>,<span class="va">Cmean</span><span class="op">$</span><span class="va">Belongings</span>,m<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">df</span>,
             digits <span class="op">=</span> <span class="fl">3</span>,col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GFCM"</span>, <span class="st">"FCM"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">GFCM</th>
<th align="right">FCM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Silhouette.index</td>
<td align="right">0.358</td>
<td align="right">0.363</td>
</tr>
<tr class="even">
<td align="left">Partition.entropy</td>
<td align="right">0.323</td>
<td align="right">0.732</td>
</tr>
<tr class="odd">
<td align="left">Partition.coeff</td>
<td align="right">0.833</td>
<td align="right">0.607</td>
</tr>
<tr class="even">
<td align="left">XieBeni.index</td>
<td align="right">0.852</td>
<td align="right">1.352</td>
</tr>
<tr class="odd">
<td align="left">FukuyamaSugeno.index</td>
<td align="right">585.977</td>
<td align="right">1860.772</td>
</tr>
<tr class="even">
<td align="left">Explained.inertia</td>
<td align="right">0.428</td>
<td align="right">0.302</td>
</tr>
</tbody>
</table>
<p>The results indicate that the GFCM provides a solution that is less fuzzy (higher explained inertia and lower partition entropy) but keeps a good silhouette index and an even better Xie and Beni index.</p>
<p>We can now map the two membership matrices and the most likely group for each observation. To do so, we use the function <em>mapClusters</em> from <strong>geocmeans</strong>. We propose here to define a threshold of 0.45. If an observation only has values below this probability in a membership matrix, it will be labeled as “undecided” (represented with transparency on the map).</p>
<p>We can compare the maps of the classical c-means and the generalized version.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cmeansMaps</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapClusters.html">mapClusters</a></span><span class="op">(</span><span class="va">LyonIris</span>,<span class="va">Cmean</span><span class="op">$</span><span class="va">Belongings</span>,undecided <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>
<span class="va">GcmeansMaps</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapClusters.html">mapClusters</a></span><span class="op">(</span><span class="va">LyonIris</span>,<span class="va">GCmean</span><span class="op">$</span><span class="va">Belongings</span>,undecided <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>

<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">cmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">GcmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
          nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-10-1.png" alt="Probability of belonging to cluster 1" width="80%"><p class="caption">
Probability of belonging to cluster 1
</p>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">cmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="va">GcmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, 
          nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-11-1.png" alt="Probability of belonging to cluster 2" width="80%"><p class="caption">
Probability of belonging to cluster 2
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">cmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,<span class="va">GcmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, 
          nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-12-1.png" alt="Probability of belonging to cluster 3" width="80%"><p class="caption">
Probability of belonging to cluster 3
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">cmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,<span class="va">GcmeansMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, 
          nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-13-1.png" alt="Probability of belonging to cluster 4" width="80%"><p class="caption">
Probability of belonging to cluster 4
</p>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">cmeansMaps</span><span class="op">$</span><span class="va">ClusterPlot</span>,<span class="va">GcmeansMaps</span><span class="op">$</span><span class="va">ClusterPlot</span>,
          nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-14-1.png" alt="Most likely clusters and undecided units" width="80%"><p class="caption">
Most likely clusters and undecided units
</p>
</div>
<p>As expected, the results are very similar, but the generalized version provides a more clear-cut classification.</p>
</div>
<div id="spatial-c-means-and-generalized-c-means" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-c-means-and-generalized-c-means" class="anchor"></a>Spatial c-means and generalized c-means</h2>
<div id="selecting-alpha-for-sfcm" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-alpha-for-sfcm" class="anchor"></a>Selecting alpha for SFCM</h3>
<p>Now we can use the <em>SFCM</em> function to perform a spatial c-means. The first step is to define a spatial weight matrix indicating which observations are neighbours and the strength of their relationship. We propose here to use a basic queen neighbour matrix (built with <strong>spdep</strong>). The matrix must be row-standardized to ensure that the interpretation of all the parameters remains clear.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/">spdep</a></span><span class="op">)</span>

<span class="va">Neighbours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spdep/man/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>,queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">WMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spdep/man/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">Neighbours</span>,style<span class="op">=</span><span class="st">"W"</span>,zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The main challenge with the SFCM method is to select the parameter <em>alpha</em>. It represents the weight of the spatial dimension (lagged values) in the calculus of the membership matrix and the cluster centers.</p>
<ul>
<li>If alpha=0, then we end up with a classical c-means algorithm.</li>
<li>If alpha=1, then the original and the lagged values have the same weight</li>
<li>If alpha=2, then the lagged values are twice more important than the original values</li>
<li>end so on…</li>
</ul>
<p>The two following formulas show how the functions updating the membership matrix and the centers of the clusters are modified.</p>
<p><span class="math display">\[u_{ik} = \frac{(||x_{k} - v{_i}||^2 + \alpha||\bar{x_{k}} - v{_i}||^2)^{(-1/(m-1))}}{\sum_{j=1}^c(||x_{k} - v{_j}||^2 + \alpha||\bar{x_{k}} - v{_j}||^2)^{(-1/(m-1))}}\]</span></p>
<p><span class="math display">\[v_{i} = \frac{\sum_{k=1}^N u_{ik}^m(x_{k} + \alpha\bar{x_{k}})}{(1 + \alpha)\sum_{k=1}^N u_{ik}^m}\]</span> with <span class="math inline">\(\bar{x}\)</span> the lagged version of x and <span class="math inline">\(\alpha \geq 0\)</span></p>
<p>As the formula suggests, the <em>SFCM</em> can be seen as a spatially smoothed version of the classical c-means and <em>alpha</em> controls the degree of spatial smoothness. This smoothing can be interpreted as an attempt to reduce spatial overfitting of the classical c-means.</p>
<p>To select <em>alpha</em>, we propose to check all possible values between 0 and 2 with a step of 0.05.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DFindices_SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_parameters.html">selectParameters</a></span><span class="op">(</span>algo <span class="op">=</span> <span class="st">"SFCM"</span>, data <span class="op">=</span> <span class="va">Data</span>,
                               k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0.05</span><span class="op">)</span>,
                               nblistw <span class="op">=</span> <span class="va">WMat</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>,
                               tol <span class="op">=</span> <span class="fl">0.0001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
<p>Now we are able to check the indices to select the best <em>alpha</em>. The goal is to reduce spatial inconsistency as much as possible and to maintain a good classification quality.</p>
<p>Let us start with the spatial inconsistency. This indicator (developed for this package) calculates the sum of the squared differences between each observation and its neighbours on the membership matrix. Thus, the maximum for each observation is <span class="math inline">\(k*j\)</span> with <em>j</em> the number of neighbours for the observation and <em>k</em> the number of groups. A maximum is reached if each observation has 100% chance belonging to a cluster that is different from all its neighbours. So, when we sum up the values obtained for all the observations, we obtain a quantity of spatial inconsistency. This quantity is divided by the quantity obtained when randomly permuting the rows of the membership matrix. This second quantity represents the spatial inconsistency that we might expect if the observations were randomly scattered in space. We can repeat the permutation step (Monte Carlo approach) and keep the mean of the ratios to have a more robust indicator (see help(spConsistency) for details).</p>
<p>A smaller value indicates a smaller spatial inconsistency and thus a greater spatial consistency. 0 meaning that all observations have exactly the same values in the membership matrix as their neighbours (perfect spatial consistency).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFCM</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">spConsistency</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">spConsistency</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-17-1.png" alt="Link between alpha and spatial inconsistency" width="50%"><p class="caption">
Link between alpha and spatial inconsistency
</p>
</div>
<p>Not surprisingly, increasing <em>alpha</em> leads to a decrease of the spatial inconsistency. This gain follows an inverse function.</p>
<p>Let us now check the explained inertia</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFCM</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">Explained.inertia</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">Explained.inertia</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = 'loess' and formula 'y ~ x'</code></pre>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-18-1.png" alt="Link between alpha and explained inertia" width="50%"><p class="caption">
Link between alpha and explained inertia
</p>
</div>
<p>As expected, the explained inertia decreases when alpha increases and again follows an inverse function. The classification has to find a compromise between the original values and the lagged values. However, the loss is very small here: only 3% between alpha = 0 and alpha = 2.</p>
<p>To finish here, we can observe the silhouette and Xie and Beni indicators.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFCM</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">Silhouette.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">Silhouette.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-19-1.png" alt="Link between alpha and silhouette index" width="50%"><p class="caption">
Link between alpha and silhouette index
</p>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFCM</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">XieBeni.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">alpha</span>,y<span class="op">=</span><span class="va">XieBeni.index</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-20-1.png" alt="Link between alpha and Xie and Beni index" width="50%"><p class="caption">
Link between alpha and Xie and Beni index
</p>
</div>
<p>The detail of the meaning of these indicators is beyond the scope of this vignette. Let us just stress that a larger silhouette index indicates a better classification, and a smaller Xie and Beni index indicates a better classification.</p>
<p>After considering all the previous charts, we decide to keep alpha = 0.7 as it seems to provide a good balance between spatial consistency and classification quality in this case.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SFCMeans.html">SFCMeans</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">WMat</span>, k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>,
                 tol <span class="op">=</span> <span class="fl">0.0001</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>,
                 verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
</div>
<div id="selecting-alpha-and-beta-for-sgfcm" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-alpha-and-beta-for-sgfcm" class="anchor"></a>Selecting alpha and beta for SGFCM</h3>
<p>It is also possible to use the so-called generalized version of the spatial c-means. In that case, we must define both <em>alpha</em> and <em>beta</em>.</p>
<p>The next formula shows how the membership matrix is updated at each iteration. Note that the centres of the clusters are updated with the same formula as SFCM.</p>
<p><span class="math display">\[u_{ik} = \frac{(||x_{k} - v{_i}||^2 -\beta_k + \alpha||\bar{x_{k}} - v{_i}||^2)^{(-1/(m-1))}}{\sum_{j=1}^c(||x_{k} - v{_j}||^2 -\beta_k + \alpha||\bar{x_{k}} - v{_j}||^2)^{(-1/(m-1))}}\]</span></p>
<p>Because we select a high resolution for our grid search of <em>alpha</em> and <em>beta</em>, we will use a multiprocessing approach.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/multiprocess.html">multiprocess</a></span><span class="op">(</span>workers<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="va">DFindices_SFGCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_parameters.mc.html">selectParameters.mc</a></span><span class="op">(</span>algo <span class="op">=</span> <span class="st">"SGFCM"</span>, data <span class="op">=</span> <span class="va">Data</span>,
                               k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">0.05</span><span class="op">)</span>,
                               beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.85</span>,<span class="fl">0.05</span><span class="op">)</span>,
                               nblistw <span class="op">=</span> <span class="va">WMat</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>, chunk_size <span class="op">=</span> <span class="fl">50</span>,
                               tol <span class="op">=</span> <span class="fl">0.0001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFGCM</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">beta</span>, fill <span class="op">=</span> <span class="va">Silhouette.index</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-23-1.png" alt="Impact of beta and alpha on silhouette index" width="80%"><p class="caption">
Impact of beta and alpha on silhouette index
</p>
</div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFGCM</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">beta</span>, fill <span class="op">=</span> <span class="va">XieBeni.index</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-24-1.png" alt="Impact of beta and alpha on Xie and Beni index" width="80%"><p class="caption">
Impact of beta and alpha on Xie and Beni index
</p>
</div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DFindices_SFGCM</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alpha</span>, y <span class="op">=</span> <span class="va">beta</span>, fill <span class="op">=</span> <span class="va">spConsistency</span><span class="op">)</span>,  size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html">scale_fill_viridis</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-25-1.png" alt="Impact of beta and alpha on spatial inconsistency" width="80%"><p class="caption">
Impact of beta and alpha on spatial inconsistency
</p>
</div>
<p>The first two plots indicate that some specific pairs of <em>alpha</em> and <em>beta</em> yield good results in the range 0.8 &lt; <em>alpha</em> &lt; 1.2 and 0.6 &lt; <em>beta</em> &lt; 0.8. The last plot shows that the selection of <em>beta</em> has no impact on the spatial consistency.</p>
<p>Considering the previous plots, we decide to retain the solution with <em>beta</em> = 0.65 and <em>alpha</em> = 0.95 which yield very good results for all the indices considered.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SGFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SGFCMeans.html">SGFCMeans</a></span><span class="op">(</span><span class="va">Data</span>,<span class="va">WMat</span>,k <span class="op">=</span> <span class="fl">4</span>,m<span class="op">=</span><span class="fl">1.5</span>, alpha<span class="op">=</span><span class="fl">0.95</span>, beta <span class="op">=</span> <span class="fl">0.65</span>,
                    tol<span class="op">=</span><span class="fl">0.0001</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
<p>Again, we compare here the generalized and the classical version of the spatial c-means algorithm.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>,m <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>
<span class="va">r2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcqualityIndexes.html">calcqualityIndexes</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>,m <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span>

<span class="va">diagSFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>,
                        undecided <span class="op">=</span> <span class="fl">0.45</span>,nrep <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="va">diagSGFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>,
                         undecided <span class="op">=</span> <span class="fl">0.45</span>,nrep <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">r1</span><span class="op">)</span>,<span class="va">diagSFCM</span><span class="op">$</span><span class="va">SpConsist</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">r2</span><span class="op">)</span>,<span class="va">diagSGFCM</span><span class="op">$</span><span class="va">SpConsist</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"sp.consistency"</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">df</span>,digits <span class="op">=</span> <span class="fl">3</span>,col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SFCM"</span>,<span class="st">"SGFCM"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">SFCM</th>
<th align="right">SGFCM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Silhouette.index</td>
<td align="right">0.370</td>
<td align="right">0.391</td>
</tr>
<tr class="even">
<td align="left">Partition.entropy</td>
<td align="right">0.765</td>
<td align="right">0.544</td>
</tr>
<tr class="odd">
<td align="left">Partition.coeff</td>
<td align="right">0.592</td>
<td align="right">0.715</td>
</tr>
<tr class="even">
<td align="left">XieBeni.index</td>
<td align="right">1.976</td>
<td align="right">0.971</td>
</tr>
<tr class="odd">
<td align="left">FukuyamaSugeno.index</td>
<td align="right">2228.507</td>
<td align="right">1585.559</td>
</tr>
<tr class="even">
<td align="left">Explained.inertia</td>
<td align="right">0.274</td>
<td align="right">0.347</td>
</tr>
<tr class="odd">
<td align="left">sp.consistency</td>
<td align="right">0.183</td>
<td align="right">0.171</td>
</tr>
</tbody>
</table>
<p>The solution of the SGFCM is better on the semantic and the spatial aspects.</p>
<p>We can compare the maps</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SFCMMaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapClusters.html">mapClusters</a></span><span class="op">(</span>geodata <span class="op">=</span> <span class="va">LyonIris</span>, object <span class="op">=</span> <span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>,undecided <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>
<span class="va">SGFCMMaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mapClusters.html">mapClusters</a></span><span class="op">(</span>geodata <span class="op">=</span> <span class="va">LyonIris</span>, object <span class="op">=</span> <span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>,undecided <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>

<span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">SFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="va">SGFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-28-1.png" alt="Probability of belonging to cluster 1" width="80%"><p class="caption">
Probability of belonging to cluster 1
</p>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">SFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,<span class="va">SGFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-29-1.png" alt="Probability of belonging to cluster 2" width="80%"><p class="caption">
Probability of belonging to cluster 2
</p>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">SFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,<span class="va">SGFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-30-1.png" alt="Probability of belonging to cluster 3" width="80%"><p class="caption">
Probability of belonging to cluster 3
</p>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">SFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,<span class="va">SGFCMMaps</span><span class="op">$</span><span class="va">ProbaMaps</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="introduction_files/figure-html/unnamed-chunk-31-1.png" alt="Probability of belonging to cluster 4" width="80%"><p class="caption">
Probability of belonging to cluster 4
</p>
</div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html">ggarrange</a></span><span class="op">(</span><span class="va">SFCMMaps</span><span class="op">$</span><span class="va">ClusterPlot</span>,<span class="va">SGFCMMaps</span><span class="op">$</span><span class="va">ClusterPlot</span>, nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span>,
          common.legend <span class="op">=</span> <span class="cn">TRUE</span>, legend <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="introduction_files/figure-html/unnamed-chunk-32-1.png" alt="Most likely cluster and undecided units" width="80%"><p class="caption">
Most likely cluster and undecided units
</p>
</div>
</div>
</div>
<div id="comparing-the-spatial-consistency-of-fcm-gfcm-sfcm-and-sgfcm" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-the-spatial-consistency-of-fcm-gfcm-sfcm-and-sgfcm" class="anchor"></a>Comparing the spatial consistency of FCM, GFCM, SFCM and SGFCM</h2>
<p>Now, we can do a deeper spatial analysis and compare the spatial consistency of the four classifications realized (FCM, GFCM, SFCM, SGFCM).</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spdiag_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">Cmean</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>, nrep<span class="op">=</span><span class="fl">250</span><span class="op">)</span>
<span class="va">spdiag_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">GCmean</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>, nrep<span class="op">=</span><span class="fl">250</span><span class="op">)</span>
<span class="va">spdiag_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>, nrep<span class="op">=</span><span class="fl">250</span><span class="op">)</span>
<span class="va">spdiag_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialDiag.html">spatialDiag</a></span><span class="op">(</span><span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>, nblistw <span class="op">=</span> <span class="va">WMat</span>, nrep<span class="op">=</span><span class="fl">250</span><span class="op">)</span>

<span class="co">#looking at the moran I values for each group</span>
<span class="va">moran_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">spdiag_1</span><span class="op">$</span><span class="va">MoranValues</span><span class="op">$</span><span class="va">MoranI</span>,
                     <span class="va">spdiag_2</span><span class="op">$</span><span class="va">MoranValues</span><span class="op">$</span><span class="va">MoranI</span>,
                     <span class="va">spdiag_3</span><span class="op">$</span><span class="va">MoranValues</span><span class="op">$</span><span class="va">MoranI</span>,
                     <span class="va">spdiag_4</span><span class="op">$</span><span class="va">MoranValues</span><span class="op">$</span><span class="va">MoranI</span>
                     <span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/row.names.html">row.names</a></span><span class="op">(</span><span class="va">moran_table</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"cluster "</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">moran_table</span>, digits <span class="op">=</span> <span class="fl">3</span>,
             col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FCM"</span>,<span class="st">"GFCM"</span>,<span class="st">"SFCM"</span>,<span class="st">"SGFCM"</span><span class="op">)</span>,
             caption <span class="op">=</span> <span class="st">"Moran I index for the columns of the membership matrix"</span>
             <span class="op">)</span></code></pre></div>
<table class="table">
<caption>Moran I index for the columns of the membership matrix</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">FCM</th>
<th align="right">GFCM</th>
<th align="right">SFCM</th>
<th align="right">SGFCM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">cluster 1</td>
<td align="right">0.835</td>
<td align="right">0.789</td>
<td align="right">0.908</td>
<td align="right">0.913</td>
</tr>
<tr class="even">
<td align="left">cluster 2</td>
<td align="right">0.723</td>
<td align="right">0.624</td>
<td align="right">0.860</td>
<td align="right">0.865</td>
</tr>
<tr class="odd">
<td align="left">cluster 3</td>
<td align="right">0.389</td>
<td align="right">0.408</td>
<td align="right">0.645</td>
<td align="right">0.703</td>
</tr>
<tr class="even">
<td align="left">cluster 4</td>
<td align="right">0.547</td>
<td align="right">0.489</td>
<td align="right">0.749</td>
<td align="right">0.741</td>
</tr>
</tbody>
</table>
<p>Not surprisingly, the Moran I values calculated on the membership matrices are higher for SFCM and SGFCM, indicating stronger spatial structures in the classifications.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">spdiag_1</span><span class="op">$</span><span class="va">SpConsist</span>, <span class="va">spdiag_2</span><span class="op">$</span><span class="va">SpConsist</span>,<span class="va">spdiag_3</span><span class="op">$</span><span class="va">SpConsist</span>,<span class="va">spdiag_4</span><span class="op">$</span><span class="va">SpConsist</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.3344399 0.3933804 0.1837933 0.1713737</code></pre>
<p>Considering the values of spatial inconsistency, we could check if the value obtained for SGFCM is significantly lower than the one of SFCM. Considering the previous 250 values obtained by permutations, we can calculate a pseudo p-value:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">spdiag_4</span><span class="op">$</span><span class="va">SpConsist</span> <span class="op">&gt;</span> <span class="va">spdiag_3</span><span class="op">$</span><span class="va">SpConsistSamples</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">spdiag_3</span><span class="op">$</span><span class="va">SpConsistSamples</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>It appears that out of 250 permutations, the observed values of spatial inconsistency of SGFCM are always lower than that of SFCM. The difference is significant at the threshold 0.004 (=1/250)</p>
<p>We can map the undecided observations of the final solution. These entities should be analyzed more precisely. Selecting them is easy with the function <em>undecidedUnits</em> of the <strong>geocmeans</strong> package.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Undecided</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/undecidedUnits.html">undecidedUnits</a></span><span class="op">(</span><span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>,<span class="fl">0.45</span><span class="op">)</span>
<span class="va">LyonIris</span><span class="op">$</span><span class="va">FinalCluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">Undecided</span><span class="op">==</span><span class="st">"Undecided"</span>,
                                <span class="st">"Undecided"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"cluster"</span>,<span class="va">Undecided</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># mapping the groups</span>
<span class="va">DFmapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/merge.html">merge</a></span><span class="op">(</span><span class="va">FortiData</span>,<span class="va">LyonIris</span>,by.x<span class="op">=</span><span class="st">"id"</span>,by.y<span class="op">=</span><span class="st">"OID"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">DFmapping</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span>,fill<span class="op">=</span><span class="va">FinalCluster</span><span class="op">)</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"FinalCluster"</span>,values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cluster_V1"</span><span class="op">=</span><span class="st">"palegreen3"</span>,
                                 <span class="st">"cluster_V2"</span><span class="op">=</span><span class="st">"firebrick"</span>,
                                 <span class="st">"cluster_V3"</span><span class="op">=</span><span class="st">"lightyellow2"</span>,
                                 <span class="st">"cluster_V4"</span><span class="op">=</span><span class="st">"steelblue"</span>,
                                 <span class="st">"cluster_V5"</span><span class="op">=</span><span class="st">"pink"</span>,
                                 <span class="st">"Undecided"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span> axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-36-1.png" width="700"></p>
<p>It is also possible to visualize the uncertainty by using jittered points. The idea is to draw random points in polygons and attribute them to a group proportionally to the membership values of the polygon the fall in.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"palegreen3"</span>,<span class="st">"firebrick"</span>,<span class="st">"lightyellow2"</span>,<span class="st">"steelblue"</span>,<span class="st">"pink"</span><span class="op">)</span>
<span class="fu"><a href="../reference/uncertaintyMap.html">uncertaintyMap</a></span><span class="op">(</span><span class="va">LyonIris</span>, <span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>, color <span class="op">=</span> <span class="va">colors</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<p>To quantify and map uncertainty, one could Calculate the Shanon entropy index and use it as a measure of uncertainty with the function <code>calcUncertaintyIndex.</code> A value of 1 indicates that an observation has equal membership values among groups and a value of 0 indicates that an observation belongs to only one group.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LyonIris</span><span class="op">$</span><span class="va">entropyidx</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcUncertaintyIndex.html">calcUncertaintyIndex</a></span><span class="op">(</span><span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span><span class="op">)</span>

<span class="co"># mapping the uncertainty</span>
<span class="va">DFmapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/merge.html">merge</a></span><span class="op">(</span><span class="va">FortiData</span>,<span class="va">LyonIris</span>,by.x<span class="op">=</span><span class="st">"id"</span>,by.y<span class="op">=</span><span class="st">"OID"</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">DFmapping</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">long</span>,y<span class="op">=</span><span class="va">lat</span>,group<span class="op">=</span><span class="va">group</span>,fill<span class="op">=</span><span class="va">entropyidx</span><span class="op">)</span>,color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Uncertainty evaluation"</span>, fill <span class="op">=</span> <span class="st">"entropy index"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
</div>
<div id="interpreting-the-results-of-the-final-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#interpreting-the-results-of-the-final-classification" class="anchor"></a>Interpreting the results of the final classification</h2>
<p>One can obtain a lot of descriptive information about the final groups with four functions of <strong>geocmeans</strong> :</p>
<ul>
<li>
<code>summarizeClusters</code>: calculate summary statistics for each group for a given dataset by using the membership matrix as weights (sticking with the fuzzy spirit). One can also use the generic function <code>summary</code>
</li>
<li>
<code>spiderPlots</code>: display a spider plot allowing to compare quickly the differences between groups.</li>
<li>
<code>violinPlots</code>: display a violin plot for each variable in a given dataset. Observations must be grouped before.</li>
<li>
<code>sp_clust_explorer</code>: launch a shiny app to investigate the results dynamically.</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/summarizeClusters.html">summarizeClusters</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">AnalysisFields</span><span class="op">]</span>,belongmatrix <span class="op">=</span> <span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>,
                  weighted <span class="op">=</span> <span class="cn">TRUE</span>, dec <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## $Cluster_1
##      Lden   NO2    PM25   VegHautPrt Pct0_14 Pct_65 Pct_Img TxChom1564
## Q5   50.589 27.985 16.784 6.338      8.32    6.77   6.046   7.785     
## Q10  51.585 29.228 17.273 7.78       10.331  8.408  6.902   8.577     
## Q25  53.776 30.867 18.333 10.334     12.47   10.736 8.825   11.114    
## Q50  56.383 35.037 18.952 13.855     15.023  13.891 11.98   13.119    
## Q75  59.117 38.881 19.582 18.091     17.456  17.495 15.248  15.495    
## Q90  62.474 41.146 20.004 26.082     19.673  20.509 18.629  18.429    
## Q95  64.175 44.365 20.206 31.659     21.192  22.987 20.193  20.58     
## Mean 56.627 35.058 18.771 15.294     14.91   14.085 12.449  13.567    
## Std  4.37   5.766  1.208  7.716      4.416   5.184  5.642   5.298     
##      Pct_brevet NivVieMed
## Q5   7.221      17419.89 
## Q10  8.474      18717.44 
## Q25  10.738     20126.27 
## Q50  13.995     22572.24 
## Q75  19.769     24717.11 
## Q90  25.535     28046.09 
## Q95  30.333     31046.21 
## Mean 15.935     22869.05 
## Std  8.182      4004.629 
## 
## $Cluster_2
##      Lden   NO2    PM25   VegHautPrt Pct0_14 Pct_65 Pct_Img TxChom1564
## Q5   44.821 14.772 12.649 12.107     12.776  12.691 3.787   6.723     
## Q10  45.822 15.692 12.92  14.655     14.297  13.379 4.259   6.999     
## Q25  49.654 18.685 13.741 21.742     16.697  16.145 5.738   7.934     
## Q50  52.309 22.074 14.555 28.635     18.605  19.207 7.466   9.603     
## Q75  54.808 25.971 15.695 36.48      20.816  22.612 10.08   12        
## Q90  58.116 29     16.534 42.041     22.335  27.455 14.174  15.045    
## Q95  60.163 32.396 17.279 44.911     22.837  29.579 17.32   17.7      
## Mean 52.16  22.436 14.748 28.341     18.402  19.835 8.51    10.619    
## Std  4.802  5.595  1.514  10.238     3.598   5.877  4.842   5.629     
##      Pct_brevet NivVieMed
## Q5   10.061     19832.54 
## Q10  11.654     20783.62 
## Q25  14.719     22402    
## Q50  18.432     24529.81 
## Q75  23.231     28399.48 
## Q90  29.32      31031.92 
## Q95  32.451     34184.69 
## Mean 19.709     25380.5  
## Std  8.288      4369.744 
## 
## $Cluster_3
##      Lden   NO2    PM25   VegHautPrt Pct0_14 Pct_65 Pct_Img TxChom1564
## Q5   49.798 17.78  13.828 6.066      12.75   9.204  5.735   7.014     
## Q10  51.342 19.266 14.049 7.239      14.851  11.218 7.021   8.042     
## Q25  53.119 21.734 15.145 10.739     17.284  13.915 9.308   10.341    
## Q50  55.599 25.39  15.653 14.948     19.483  17.316 12.747  13.1      
## Q75  58.777 30.382 17.072 20.608     21.744  20.907 18.397  16.651    
## Q90  62.58  35.164 18.582 29.932     24.515  23.814 22.821  20.836    
## Q95  63.937 38.523 18.883 34.84      26.302  25.504 28.424  24.37     
## Mean 56.114 26.145 16.019 16.576     19.358  17.264 14.365  14.031    
## Std  4.53   6.411  1.614  8.737      4.516   5.483  7.41    7.063     
##      Pct_brevet NivVieMed
## Q5   13.488     15635.58 
## Q10  17.02      16542.05 
## Q25  20.781     18807.47 
## Q50  25.835     20432.88 
## Q75  32.021     23025.93 
## Q90  38.279     25212.17 
## Q95  43.764     26277.2  
## Mean 27.216     20877.06 
## Std  10.51      3534.834 
## 
## $Cluster_4
##      Lden   NO2    PM25   VegHautPrt Pct0_14 Pct_65 Pct_Img TxChom1564
## Q5   51.576 20.041 14.136 6.455      16.48   7.549  10.481  11.133    
## Q10  52.383 21.383 14.56  7.648      18.483  8.95   16.123  13.787    
## Q25  55.067 23.266 15.907 10.844     21.452  11.048 21.007  17.872    
## Q50  57.243 26.534 16.538 14.218     24.398  13.815 27.056  23.003    
## Q75  59.53  31.85  17.733 18.387     27.6    17.125 32.865  31.83     
## Q90  63.441 37.186 18.757 24.835     30.974  20.535 38.25   34.394    
## Q95  64.732 39.63  19.068 28.607     32.41   23.228 41.005  37.971    
## Mean 57.515 27.99  16.693 15.476     24.403  14.223 26.758  24.189    
## Std  4.253  6.622  1.518  7.25       6.315   5.024  9.457   9.479     
##      Pct_brevet NivVieMed
## Q5   21.535     12404.91 
## Q10  26.811     12891.14 
## Q25  32.702     13852.68 
## Q50  38.41      15648.12 
## Q75  45.03      18117.52 
## Q90  49.569     19545.97 
## Q95  53.699     21898.08 
## Mean 38.608     16111.03 
## Std  11.927     3117.687</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># equivalent to : </span>
<span class="co"># summary(SGFCM, LyonIris@data[AnalysisFields])</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/spiderPlots.html">spiderPlots</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">AnalysisFields</span><span class="op">]</span>, <span class="va">SGFCM</span><span class="op">$</span><span class="va">Belongings</span>,
            chartcolors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"darkorange3"</span>,<span class="st">"grey4"</span>,<span class="st">"darkgreen"</span>,<span class="st">"royalblue"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/violinPlots.html">violinPlots</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">AnalysisFields</span><span class="op">]</span>, <span class="va">SGFCM</span><span class="op">$</span><span class="va">Groups</span><span class="op">)</span></code></pre></div>
</div>
<div id="ensuring-clustering-stability" class="section level2">
<h2 class="hasAnchor">
<a href="#ensuring-clustering-stability" class="anchor"></a>Ensuring clustering stability</h2>
<p>All the clustering algorithms of this package depends on a initial state that might influence the results. A good practice is to check the results to ensure that the groups obtained are stable if we replicate the analysis. The function <code>boost_group_validation</code> proposes an approach based on bootstrapping.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bootvalues</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boot_group_validation.html">boot_group_validation</a></span><span class="op">(</span><span class="va">SGFCM</span>, nsim <span class="op">=</span> <span class="fl">1000</span>, maxiter <span class="op">=</span> <span class="fl">1000</span>, 
                                     tol <span class="op">=</span> <span class="fl">0.0001</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>We can now check if the groups are stable across simulations.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">melted_df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">bootvalues</span><span class="op">$</span><span class="va">group_consistency</span><span class="op">)</span></code></pre></div>
<pre><code>## No id variables; using all as measure variables</code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">melted_df</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span><span class="op">(</span><span class="va">melted_df</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">melted_df</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stability of clusters"</span>, subtitle <span class="op">=</span> <span class="st">"for 1000 iterations"</span>,
       x <span class="op">=</span> <span class="st">"Jaccard index"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-42-1.png" width="700"></p>
<p>The Jaccard index is calculated at each replication and for each cluster in comparison with the original result. A greater value means a more stable cluster. Values above 0.75 indicate a stable cluster. Values between 0.5 and 0.75 indicate a cluster with some uncertainty. Under 0.5, the cluster tends to dissolve during the iterations. In the presented case, the group 3 is more worisome with many Jacard values under 0.5.</p>
<p>We can check the values of the centers of the group 3 across the 1000 iterations.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_gp3</span> <span class="op">&lt;-</span> <span class="va">bootvalues</span><span class="op">$</span><span class="va">group_centers</span><span class="op">[[</span><span class="st">"group3"</span><span class="op">]</span><span class="op">]</span>

<span class="va">melted_df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">df_gp3</span><span class="op">)</span></code></pre></div>
<pre><code>## No id variables; using all as measure variables</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">melted_df</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span><span class="op">(</span><span class="va">melted_df</span><span class="op">$</span><span class="va">variable</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">melted_df</span>, bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"stability of group 3 centers"</span>, subtitle <span class="op">=</span> <span class="st">"for 1000 iterations"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-43-1.png" width="700"> It appears that the center values for NO<sub>2</sub> and PM<sub>2.5</sub> are bimodal, that might explain why this group tends to dissolve. This could mean that group three is the combination of two very similar sub-groups.</p>
</div>
<div id="advanced-example" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-example" class="anchor"></a>Advanced example</h2>
<div id="sfcm-with-spatial-non-local-information" class="section level3">
<h3 class="hasAnchor">
<a href="#sfcm-with-spatial-non-local-information" class="anchor"></a>SFCM with spatial non-local information</h3>
<p>It has been proposed to modify the SFCM algorithm to include “non-local spatial information” instead of the information provided by close observations <span class="citation">(<a href="#ref-zhao2015multiobjective" role="doc-biblioref">Zhao, Liu, and Fan 2015</a>)</span>. Basically, this implies a modified spatial weighting scheme combining neighbouring and semantic distance. This way, more similar neighbours get more weights in the calculation of the lagged dataset which can be desirable in dataset characterized by a lot of noise. When working with a classical vector dataset, one can use the function <code>adjustSpatialWeights</code> and create a row-standardized weight matrix using the inverse of the euclidean distance between observation and their neighbours as weights.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create the modified weight matrix</span>
<span class="va">WMat_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustSpatialWeights.html">adjustSpatialWeights</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">WMat</span><span class="op">$</span><span class="va">neighbours</span>, style <span class="op">=</span> <span class="st">"W"</span><span class="op">)</span>

<span class="co"># calculate the modified version of FCM with non-local information</span>
<span class="va">nl_SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SFCMeans.html">SFCMeans</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">WMat_adj</span>, k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>,
                 tol <span class="op">=</span> <span class="fl">0.0001</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>,
                 verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span></code></pre></div>
<p>When working with rasters, the same method can be apllied by giving <code>"nl"</code> as value for the parameter <code>lag_method</code>.</p>
</div>
</div>
<div id="final-words" class="section level2">
<h2 class="hasAnchor">
<a href="#final-words" class="anchor"></a>Final words</h2>
<p>That’s all, folks ! Following are the enhancements for the next version</p>
<ul>
<li>introduce other methods of spatial c-means</li>
<li>open some other parameters to the user (such as the function defining the convergence criterion)</li>
<li>work on documentation</li>
</ul>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-cai2007fast" class="csl-entry">
Cai, Weiling, Songcan Chen, and Daoqiang Zhang. 2007. <span>“Fast and Robust Fuzzy c-Means Clustering Algorithms Incorporating Local Information for Image Segmentation.”</span> <em>Pattern Recognition</em> 40 (3): 825–38.
</div>
<div id="ref-gelb2021apport" class="csl-entry">
Gelb, Jérémy, and Philippe Apparicio. 2021. <span>“Apport de La Classification Floue c-Means Spatiale En g<span>é</span>ographie: Essai de Taxinomie Socio-r<span>é</span>sidentielle Et Environnementale <span class="nocase">à</span> Lyon.”</span> <em>Cybergeo: European Journal of Geography</em>.
</div>
<div id="ref-zhao2013kernel" class="csl-entry">
Zhao, Feng, Licheng Jiao, and Hanqiang Liu. 2013. <span>“Kernel Generalized Fuzzy c-Means Clustering with Spatial Information for Image Segmentation.”</span> <em>Digital Signal Processing</em> 23 (1): 184–99.
</div>
<div id="ref-zhao2015multiobjective" class="csl-entry">
Zhao, Feng, Hanqiang Liu, and Jiulun Fan. 2015. <span>“A Multiobjective Spatial Fuzzy Clustering Algorithm for Image Segmentation.”</span> <em>Applied Soft Computing</em> 30: 48–57.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
