<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An adjusted spatial inconsistency index • geocmeans</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An adjusted spatial inconsistency index">
<meta property="og:description" content="geocmeans">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocmeans</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adjustinconsistency.html">An adjusted spatial inconsistency index</a>
    </li>
    <li>
      <a href="../articles/FCMres.html">Creating a FCMres object</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Spatial Fuzzy CMean with R</a>
    </li>
    <li>
      <a href="../articles/rasters.html">Fuzzy clustering with rasters</a>
    </li>
    <li>
      <a href="../articles/web_vignettes/advanced_examples.html">Advanced examples</a>
    </li>
    <li>
      <a href="../articles/web_vignettes/optimizing_parameters.html">Optimizing Parameters</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JeremyGelb/geocmeans/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An adjusted spatial inconsistency index</h1>
                        <h4 data-toc-skip class="author">Jeremy
Gelb</h4>
            
            <h4 data-toc-skip class="date">02/04/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JeremyGelb/geocmeans/blob/HEAD/vignettes/adjustinconsistency.Rmd" class="external-link"><code>vignettes/adjustinconsistency.Rmd</code></a></small>
      <div class="hidden name"><code>adjustinconsistency.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette is a short description of an adjusted version of the
spatial inconsistency index proposed in the package
<strong>geocmeans</strong>. For a published reference, please consider
citing <span class="citation">Gelb and Apparicio (<a href="#ref-gelb2021apport" role="doc-biblioref">2021</a>)</span>.</p>
<p>Most of the time, data with a spatial component show an
autocorrelated structure: close observations tend to be more similar
than distant ones. Classical unsupervised classification algorithms do
not account for space and tend to produce scattered results. In other
words, some close observations may end up in different clusters despite
their differences not being too pronounced. Spatially aware clustering
algorithms try to correct this by spatially smoothing the results.</p>
</div>
<div class="section level2">
<h2 id="spatial-inconsistency-index">Spatial inconsistency index<a class="anchor" aria-label="anchor" href="#spatial-inconsistency-index"></a>
</h2>
<p>We proposed an index <span class="math inline">\(S_{cr}\)</span> to
measure the spatial inconsistency of a classification considering its
membership matrix <span class="math inline">\(u\)</span> and a spatial
weight matrix <span class="math inline">\(w\)</span>. It is simply the
sum of the Euclidean distance of each observation <span class="math inline">\(k\)</span> to its spatial neighbours <span class="math inline">\(l\)</span> on the membership matrix, weighted by
the spatial wight matrix.</p>
<p><span class="math display">\[S_{cr}=\sum_{k=1}^{k} \sum_{l=1}^{l}
w_{k l}\left\|u_{k}-u_{l}\right\|^{2}\]</span></p>
<p>Because it is based on the euclidean distance, this index is related
to the Gueary’s C:</p>
<p><span class="math display">\[C=\frac{(N-1) \sum_{k} \sum_{l} w_{k
l}\left(x_{k}-x_{l}\right)^{2}}{2 W
\sum_{k}\left(x_{k}-\bar{x}\right)^{2}}\]</span></p>
<p>We also propose to standardize this sum by the total spatial
inconsistency under the assumption of total spatial randomness (obtained
by repeated permutation). A small value of this index indicates a strong
spatial consistency as observations tend to belong to the same clusters
as their neighbours. A value close to one indicates that the spatial
inconsistency of the classification is close to what one can expect from
a situation of total spatial randomness.</p>
<center>
<div class="figure">
<img src="images/spinconsistency.png" width="400" alt=""><p class="caption">Image Title</p>
</div>
</center>
<p>It is easy to calculate this index with the package
<strong>geocmeans</strong> using the function
<code>spConsistency</code></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JeremyGelb/geocmeans" class="external-link">geocmeans</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>

<span class="co">#preparing the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"LyonIris"</span><span class="op">)</span>

<span class="co">#selecting the columns for the analysis</span>
<span class="va">AnalysisFields</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Lden"</span>,<span class="st">"NO2"</span>,<span class="st">"PM25"</span>,<span class="st">"VegHautPrt"</span>,<span class="st">"Pct0_14"</span>,
                   <span class="st">"Pct_65"</span>,<span class="st">"Pct_Img"</span>,<span class="st">"TxChom1564"</span>,<span class="st">"Pct_brevet"</span>,<span class="st">"NivVieMed"</span><span class="op">)</span>

<span class="co">#rescaling the columns</span>
<span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">LyonIris</span><span class="op">[</span><span class="va">AnalysisFields</span><span class="op">]</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">Col</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">Data</span><span class="op">[[</span><span class="va">Col</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[[</span><span class="va">Col</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="co">#creating the queen spatial weight matrix</span>
<span class="va">Neighbours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/poly2nb.html" class="external-link">poly2nb</a></span><span class="op">(</span><span class="va">LyonIris</span>,queen <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">WMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/spdep/reference/nb2listw.html" class="external-link">nb2listw</a></span><span class="op">(</span><span class="va">Neighbours</span>,style<span class="op">=</span><span class="st">"W"</span>,zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#applying SFCM algorithm</span>
<span class="va">SFCM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SFCMeans.html">SFCMeans</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">WMat</span>, k <span class="op">=</span> <span class="fl">4</span>, m <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.7</span>,
                 tol <span class="op">=</span> <span class="fl">0.0001</span>, standardize <span class="op">=</span> <span class="cn">FALSE</span>,
                 verbose <span class="op">=</span> <span class="cn">FALSE</span>, seed <span class="op">=</span> <span class="fl">456</span><span class="op">)</span>

<span class="co">#calculating the spatial inconsistency index (more replications are recommended)</span>
<span class="va">consistIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spConsistency.html">spConsistency</a></span><span class="op">(</span><span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, <span class="va">WMat</span>, nrep <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">consistIndex</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>,
                 bins <span class="op">=</span> <span class="fl">30</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">consistIndex</span><span class="op">$</span><span class="va">Mean</span><span class="op">)</span>,
             color <span class="op">=</span> <span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">consistIndex</span><span class="op">$</span><span class="va">Mean</span><span class="op">+</span><span class="fl">0.0015</span>, y <span class="op">=</span> <span class="fl">43</span>,
                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">consistIndex</span><span class="op">$</span><span class="va">Mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Spatial Inconsistency Index"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adjustinconsistency_files/figure-html/unnamed-chunk-1-1.png" width="700" style="display: block; margin: auto;">
So on average, for this classification, the spatial inconsistency index
is about 0.18.</p>
</div>
<div class="section level2">
<h2 id="adjusted-spatial-inconsistency-index">Adjusted spatial inconsistency index<a class="anchor" aria-label="anchor" href="#adjusted-spatial-inconsistency-index"></a>
</h2>
<p>The spatial inconsistency index presented above has two drawbacks
:</p>
<ul>
<li>first, as the number of clusters increases, the index will increase
as well because more borders will be needed to delimit them in
space.</li>
<li>second, two close observations should not have to belong to the same
group if they are very dissimilar.</li>
</ul>
<p>To adjust the index, we propose to replace the spatial weight matrix
used in the calculus by a semantico-spatial matrix. In this matrix, the
spatial weight between two neighbours is replaced by the inverse of the
Euclidean distance between their attributes.</p>
<p><span class="math display">\[W_{kl} =
\frac{1}{||k-l||^2}\]</span></p>
<p>Thus, if two neighbours do not belong to the same cluster, but are
very dissimilar, this new semantico-spatial weight matrix will limit the
weight of their dissimilarity in the spatial inconsistency index. Note,
the new spatial matrix must be standardized globally (and not by row) to
consider the differences between observations for the full dataset and
not only at the local level. This second index is noted <span class="math inline">\(S_{mcr}\)</span>.</p>
<p>It is easy to calculate this adjusted version with the package
<strong>geocmeans</strong> by using the function
<em>adjustSpatialWeights</em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">WMat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/adjustSpatialWeights.html">adjustSpatialWeights</a></span><span class="op">(</span><span class="va">Data</span>, <span class="va">WMat</span><span class="op">$</span><span class="va">neighbours</span>, style <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span>
<span class="co"># (more replications are recommanded)</span>
<span class="va">consistIndex2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spConsistency.html">spConsistency</a></span><span class="op">(</span><span class="va">SFCM</span><span class="op">$</span><span class="va">Belongings</span>, <span class="va">WMat2</span>, nrep <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">consistIndex2</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span>,
                 bins <span class="op">=</span> <span class="fl">30</span>, fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">consistIndex2</span><span class="op">$</span><span class="va">Mean</span><span class="op">)</span>,
             color <span class="op">=</span> <span class="st">"red"</span>, linetype<span class="op">=</span><span class="st">"dashed"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">consistIndex2</span><span class="op">$</span><span class="va">Mean</span><span class="op">+</span><span class="fl">0.0015</span>, y <span class="op">=</span> <span class="fl">43</span>,
                label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">consistIndex2</span><span class="op">$</span><span class="va">Mean</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Adjusted Spatial Inconsistency Index"</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p><img src="adjustinconsistency_files/figure-html/unnamed-chunk-2-1.png" width="700" style="display: block; margin: auto;"></p>
<p>When working with rasters, it is not efficient to update the window
used to define neighbouring for each pixel and to store them. Instead,
the function <code>spConsistency</code> can be used directly on an
<code>FCMres</code> object with the parameter <code>adj</code> set to
<code>TRUE</code> to obtain the adjusted spatial inconsistency
index.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gelb2021apport" class="csl-entry">
Gelb, Jérémy, and Philippe Apparicio. 2021. <span>“Apport de La
Classification Floue c-Means Spatiale En g<span>é</span>ographie: Essai
de Taxinomie Socio-r<span>é</span>sidentielle Et Environnementale <span class="nocase">à</span> Lyon.”</span> <em>Cybergeo: European Journal of
Geography</em>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Gelb.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
